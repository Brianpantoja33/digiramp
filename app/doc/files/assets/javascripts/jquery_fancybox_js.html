<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>jquery.fancybox.js</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/github.css" type="text/css" media="screen" />
<script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            jquery.fancybox.js
        </h1>
        <ul class="files">
            <li>assets/javascripts/jquery.fancybox.js</li>
            <li>Last modified: 2015-07-05 15:22:02 +0200</li>
        </ul>
    </div>

    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<pre><code>!
 fancyBox - jQuery Plugin
 version: 2.1.5 (Fri, 14 Jun 2013)
 @requires jQuery v1.6 or later

 Examples at http://fancyapps.com/fancybox/
 License: www.fancyapps.com/fancybox/#license

 Copyright 2012 Janis Skarnelis - janis@fancyapps.com</code></pre>

<p>(function (window, document, $, undefined) {</p>

<pre><code>     &quot;use strict&quot;;

     var H = $(&quot;html&quot;),
             W = $(window),
             D = $(document),
             F = $.fancybox = function () {
                     F.open.apply( this, arguments );
             },
             IE =  navigator.userAgent.match(/msie/i),
             didUpdate       = null,
             isTouch         = document.createTouch !== undefined,

             isQuery = function(obj) {
                     return obj &amp;&amp; obj.hasOwnProperty &amp;&amp; obj instanceof $;
             },
             isString = function(str) {
                     return str &amp;&amp; $.type(str) === &quot;string&quot;;
             },
             isPercentage = function(str) {
                     return isString(str) &amp;&amp; str.indexOf(&#39;%&#39;) &gt; 0;
             },
             isScrollable = function(el) {
                     return (el &amp;&amp; !(el.style.overflow &amp;&amp; el.style.overflow === &#39;hidden&#39;) &amp;&amp; ((el.clientWidth &amp;&amp; el.scrollWidth &gt; el.clientWidth) || (el.clientHeight &amp;&amp; el.scrollHeight &gt; el.clientHeight)));
             },
             getScalar = function(orig, dim) {
                     var value = parseInt(orig, 10) || 0;

                     if (dim &amp;&amp; isPercentage(orig)) {
                             value = F.getViewport()[ dim ] / 100 * value;
                     }

                     return Math.ceil(value);
             },
             getValue = function(value, dim) {
                     return getScalar(value, dim) + &#39;px&#39;;
             };

     $.extend(F, {
             // The current version of fancyBox
             version: &#39;2.1.5&#39;,

             defaults: {
                     padding : 15,
                     margin  : 20,

                     width     : 800,
                     height    : 600,
                     minWidth  : 100,
                     minHeight : 100,
                     maxWidth  : 9999,
                     maxHeight : 9999,
                     pixelRatio: 1, // Set to 2 for retina display support

                     autoSize   : true,
                     autoHeight : false,
                     autoWidth  : false,

                     autoResize  : true,
                     autoCenter  : !isTouch,
                     fitToView   : true,
                     aspectRatio : false,
                     topRatio    : 0.5,
                     leftRatio   : 0.5,

                     scrolling : &#39;auto&#39;, // &#39;auto&#39;, &#39;yes&#39; or &#39;no&#39;
                     wrapCSS   : &#39;&#39;,

                     arrows     : true,
                     closeBtn   : true,
                     closeClick : false,
                     nextClick  : false,
                     mouseWheel : true,
                     autoPlay   : false,
                     playSpeed  : 3000,
                     preload    : 3,
                     modal      : false,
                     loop       : true,

                     ajax  : {
                             dataType : &#39;html&#39;,
                             headers  : { &#39;X-fancyBox&#39;: true }
                     },
                     iframe : {
                             scrolling : &#39;auto&#39;,
                             preload   : true
                     },
                     swf : {
                             wmode: &#39;transparent&#39;,
                             allowfullscreen   : &#39;true&#39;,
                             allowscriptaccess : &#39;always&#39;
                     },

                     keys  : {
                             next : {
                                     13 : &#39;left&#39;, // enter
                                     34 : &#39;up&#39;,   // page down
                                     39 : &#39;left&#39;, // right arrow
                                     40 : &#39;up&#39;    // down arrow
                             },
                             prev : {
                                     8  : &#39;right&#39;,  // backspace
                                     33 : &#39;down&#39;,   // page up
                                     37 : &#39;right&#39;,  // left arrow
                                     38 : &#39;down&#39;    // up arrow
                             },
                             close  : [27], // escape key
                             play   : [32], // space - start/stop slideshow
                             toggle : [70]  // letter &quot;f&quot; - toggle fullscreen
                     },

                     direction : {
                             next : &#39;left&#39;,
                             prev : &#39;right&#39;
                     },

                     scrollOutside  : true,

                     // Override some properties
                     index   : 0,
                     type    : null,
                     href    : null,
                     content : null,
                     title   : null,

                     // HTML templates
                     tpl: {
                             wrap     : &#39;&lt;div class=&quot;fancybox-wrap&quot; tabIndex=&quot;-1&quot;&gt;&lt;div class=&quot;fancybox-skin&quot;&gt;&lt;div class=&quot;fancybox-outer&quot;&gt;&lt;div class=&quot;fancybox-inner&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&#39;,
                             image    : &#39;&lt;img class=&quot;fancybox-image&quot; src=&quot;{href}&quot; alt=&quot;&quot; /&gt;&#39;,
                             iframe   : &#39;&lt;iframe id=&quot;fancybox-frame{rnd}&quot; name=&quot;fancybox-frame{rnd}&quot; class=&quot;fancybox-iframe&quot; frameborder=&quot;0&quot; vspace=&quot;0&quot; hspace=&quot;0&quot; webkitAllowFullScreen mozallowfullscreen allowFullScreen&#39; + (IE ? &#39; allowtransparency=&quot;true&quot;&#39; : &#39;&#39;) + &#39;&gt;&lt;/iframe&gt;&#39;,
                             error    : &#39;&lt;p class=&quot;fancybox-error&quot;&gt;The requested content cannot be loaded.&lt;br/&gt;Please try again later.&lt;/p&gt;&#39;,
                             closeBtn : &#39;&lt;a title=&quot;Close&quot; class=&quot;fancybox-item fancybox-close&quot; href=&quot;javascript:;&quot;&gt;&lt;/a&gt;&#39;,
                             next     : &#39;&lt;a title=&quot;Next&quot; class=&quot;fancybox-nav fancybox-next&quot; href=&quot;javascript:;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/a&gt;&#39;,
                             prev     : &#39;&lt;a title=&quot;Previous&quot; class=&quot;fancybox-nav fancybox-prev&quot; href=&quot;javascript:;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/a&gt;&#39;
                     },

                     // Properties for each animation type
                     // Opening fancyBox
                     openEffect  : &#39;fade&#39;, // &#39;elastic&#39;, &#39;fade&#39; or &#39;none&#39;
                     openSpeed   : 250,
                     openEasing  : &#39;swing&#39;,
                     openOpacity : true,
                     openMethod  : &#39;zoomIn&#39;,

                     // Closing fancyBox
                     closeEffect  : &#39;fade&#39;, // &#39;elastic&#39;, &#39;fade&#39; or &#39;none&#39;
                     closeSpeed   : 250,
                     closeEasing  : &#39;swing&#39;,
                     closeOpacity : true,
                     closeMethod  : &#39;zoomOut&#39;,

                     // Changing next gallery item
                     nextEffect : &#39;elastic&#39;, // &#39;elastic&#39;, &#39;fade&#39; or &#39;none&#39;
                     nextSpeed  : 250,
                     nextEasing : &#39;swing&#39;,
                     nextMethod : &#39;changeIn&#39;,

                     // Changing previous gallery item
                     prevEffect : &#39;elastic&#39;, // &#39;elastic&#39;, &#39;fade&#39; or &#39;none&#39;
                     prevSpeed  : 250,
                     prevEasing : &#39;swing&#39;,
                     prevMethod : &#39;changeOut&#39;,

                     // Enable default helpers
                     helpers : {
                             overlay : true,
                             title   : true
                     },

                     // Callbacks
                     onCancel     : $.noop, // If canceling
                     beforeLoad   : $.noop, // Before loading
                     afterLoad    : $.noop, // After loading
                     beforeShow   : $.noop, // Before changing in current item
                     afterShow    : $.noop, // After opening
                     beforeChange : $.noop, // Before changing gallery item
                     beforeClose  : $.noop, // Before closing
                     afterClose   : $.noop  // After closing
             },

             //Current state
             group    : {}, // Selected group
             opts     : {}, // Group options
             previous : null,  // Previous element
             coming   : null,  // Element being loaded
             current  : null,  // Currently loaded element
             isActive : false, // Is activated
             isOpen   : false, // Is currently open
             isOpened : false, // Have been fully opened at least once

             wrap  : null,
             skin  : null,
             outer : null,
             inner : null,

             player : {
                     timer    : null,
                     isActive : false
             },

             // Loaders
             ajaxLoad   : null,
             imgPreload : null,

             // Some collections
             transitions : {},
             helpers     : {},

             /*
     Static methods
 /

             open: function (group, opts) {
                     if (!group) {
                             return;
                     }

                     if (!$.isPlainObject(opts)) {
                             opts = {};
                     }

                     // Close if already active
                     if (false === F.close(true)) {
                             return;
                     }

                     // Normalize group
                     if (!$.isArray(group)) {
                             group = isQuery(group) ? $(group).get() : [group];
                     }

                     // Recheck if the type of each element is `object` and set content type (image, ajax, etc)
                     $.each(group, function(i, element) {
                             var obj = {},
                                     href,
                                     title,
                                     content,
                                     type,
                                     rez,
                                     hrefParts,
                                     selector;

                             if ($.type(element) === &quot;object&quot;) {
                                     // Check if is DOM element
                                     if (element.nodeType) {
                                             element = $(element);
                                     }

                                     if (isQuery(element)) {
                                             obj = {
                                                     href    : element.data(&#39;fancybox-href&#39;) || element.attr(&#39;href&#39;),
                                                     title   : element.data(&#39;fancybox-title&#39;) || element.attr(&#39;title&#39;),
                                                     isDom   : true,
                                                     element : element
                                             };

                                             if ($.metadata) {
                                                     $.extend(true, obj, element.metadata());
                                             }

                                     } else {
                                             obj = element;
                                     }
                             }

                             href  = opts.href  || obj.href || (isString(element) ? element : null);
                             title = opts.title !== undefined ? opts.title : obj.title || &#39;&#39;;

                             content = opts.content || obj.content;
                             type    = content ? &#39;html&#39; : (opts.type  || obj.type);

                             if (!type &amp;&amp; obj.isDom) {
                                     type = element.data(&#39;fancybox-type&#39;);

                                     if (!type) {
                                             rez  = element.prop(&#39;class&#39;).match(/fancybox\.(\w+)/);
                                             type = rez ? rez[1] : null;
                                     }
                             }

                             if (isString(href)) {
                                     // Try to guess the content type
                                     if (!type) {
                                             if (F.isImage(href)) {
                                                     type = &#39;image&#39;;

                                             } else if (F.isSWF(href)) {
                                                     type = &#39;swf&#39;;

                                             } else if (href.charAt(0) === &#39;#&#39;) {
                                                     type = &#39;inline&#39;;

                                             } else if (isString(element)) {
                                                     type    = &#39;html&#39;;
                                                     content = element;
                                             }
                                     }

                                     // Split url into two pieces with source url and content selector, e.g,
                                     // &quot;/mypage.html #my_id&quot; will load &quot;/mypage.html&quot; and display element having id &quot;my_id&quot;
                                     if (type === &#39;ajax&#39;) {
                                             hrefParts = href.split(/\s+/, 2);
                                             href      = hrefParts.shift();
                                             selector  = hrefParts.shift();
                                     }
                             }

                             if (!content) {
                                     if (type === &#39;inline&#39;) {
                                             if (href) {
                                                     content = $( isString(href) ? href.replace(/.*(?=#[^\s]+$)/, &#39;&#39;) : href ); //strip for ie7

                                             } else if (obj.isDom) {
                                                     content = element;
                                             }

                                     } else if (type === &#39;html&#39;) {
                                             content = href;

                                     } else if (!type &amp;&amp; !href &amp;&amp; obj.isDom) {
                                             type    = &#39;inline&#39;;
                                             content = element;
                                     }
                             }

                             $.extend(obj, {
                                     href     : href,
                                     type     : type,
                                     content  : content,
                                     title    : title,
                                     selector : selector
                             });

                             group[ i ] = obj;
                     });

                     // Extend the defaults
                     F.opts = $.extend(true, {}, F.defaults, opts);

                     // All options are merged recursive except keys
                     if (opts.keys !== undefined) {
                             F.opts.keys = opts.keys ? $.extend({}, F.defaults.keys, opts.keys) : false;
                     }

                     F.group = group;

                     return F._start(F.opts.index);
             },

             // Cancel image loading or abort ajax request
             cancel: function () {
                     var coming = F.coming;

                     if (!coming || false === F.trigger(&#39;onCancel&#39;)) {
                             return;
                     }

                     F.hideLoading();

                     if (F.ajaxLoad) {
                             F.ajaxLoad.abort();
                     }

                     F.ajaxLoad = null;

                     if (F.imgPreload) {
                             F.imgPreload.onload = F.imgPreload.onerror = null;
                     }

                     if (coming.wrap) {
                             coming.wrap.stop(true, true).trigger(&#39;onReset&#39;).remove();
                     }

                     F.coming = null;

                     // If the first item has been canceled, then clear everything
                     if (!F.current) {
                             F._afterZoomOut( coming );
                     }
             },

             // Start closing animation if is open; remove immediately if opening/closing
             close: function (event) {
                     F.cancel();

                     if (false === F.trigger(&#39;beforeClose&#39;)) {
                             return;
                     }

                     F.unbindEvents();

                     if (!F.isActive) {
                             return;
                     }

                     if (!F.isOpen || event === true) {
                             $(&#39;.fancybox-wrap&#39;).stop(true).trigger(&#39;onReset&#39;).remove();

                             F._afterZoomOut();

                     } else {
                             F.isOpen = F.isOpened = false;
                             F.isClosing = true;

                             $(&#39;.fancybox-item, .fancybox-nav&#39;).remove();

                             F.wrap.stop(true, true).removeClass(&#39;fancybox-opened&#39;);

                             F.transitions[ F.current.closeMethod ]();
                     }
             },

             // Manage slideshow:
             //   $.fancybox.play(); - toggle slideshow
             //   $.fancybox.play( true ); - start
             //   $.fancybox.play( false ); - stop
             play: function ( action ) {
                     var clear = function () {
                                     clearTimeout(F.player.timer);
                             },
                             set = function () {
                                     clear();

                                     if (F.current &amp;&amp; F.player.isActive) {
                                             F.player.timer = setTimeout(F.next, F.current.playSpeed);
                                     }
                             },
                             stop = function () {
                                     clear();

                                     D.unbind(&#39;.player&#39;);

                                     F.player.isActive = false;

                                     F.trigger(&#39;onPlayEnd&#39;);
                             },
                             start = function () {
                                     if (F.current &amp;&amp; (F.current.loop || F.current.index &lt; F.group.length - 1)) {
                                             F.player.isActive = true;

                                             D.bind({
                                                     &#39;onCancel.player beforeClose.player&#39; : stop,
                                                     &#39;onUpdate.player&#39;   : set,
                                                     &#39;beforeLoad.player&#39; : clear
                                             });

                                             set();

                                             F.trigger(&#39;onPlayStart&#39;);
                                     }
                             };

                     if (action === true || (!F.player.isActive &amp;&amp; action !== false)) {
                             start();
                     } else {
                             stop();
                     }
             },

             // Navigate to next gallery item
             next: function ( direction ) {
                     var current = F.current;

                     if (current) {
                             if (!isString(direction)) {
                                     direction = current.direction.next;
                             }

                             F.jumpto(current.index + 1, direction, &#39;next&#39;);
                     }
             },

             // Navigate to previous gallery item
             prev: function ( direction ) {
                     var current = F.current;

                     if (current) {
                             if (!isString(direction)) {
                                     direction = current.direction.prev;
                             }

                             F.jumpto(current.index - 1, direction, &#39;prev&#39;);
                     }
             },

             // Navigate to gallery item by index
             jumpto: function ( index, direction, router ) {
                     var current = F.current;

                     if (!current) {
                             return;
                     }

                     index = getScalar(index);

                     F.direction = direction || current.direction[ (index &gt;= current.index ? &#39;next&#39; : &#39;prev&#39;) ];
                     F.router    = router || &#39;jumpto&#39;;

                     if (current.loop) {
                             if (index &lt; 0) {
                                     index = current.group.length + (index % current.group.length);
                             }

                             index = index % current.group.length;
                     }

                     if (current.group[ index ] !== undefined) {
                             F.cancel();

                             F._start(index);
                     }
             },

             // Center inside viewport and toggle position type to fixed or absolute if needed
             reposition: function (e, onlyAbsolute) {
                     var current = F.current,
                             wrap    = current ? current.wrap : null,
                             pos;

                     if (wrap) {
                             pos = F._getPosition(onlyAbsolute);

                             if (e &amp;&amp; e.type === &#39;scroll&#39;) {
                                     delete pos.position;

                                     wrap.stop(true, true).animate(pos, 200);

                             } else {
                                     wrap.css(pos);

                                     current.pos = $.extend({}, current.dim, pos);
                             }
                     }
             },

             update: function (e) {
                     var type = (e &amp;&amp; e.type),
                             anyway = !type || type === &#39;orientationchange&#39;;

                     if (anyway) {
                             clearTimeout(didUpdate);

                             didUpdate = null;
                     }

                     if (!F.isOpen || didUpdate) {
                             return;
                     }

                     didUpdate = setTimeout(function() {
                             var current = F.current;

                             if (!current || F.isClosing) {
                                     return;
                             }

                             F.wrap.removeClass(&#39;fancybox-tmp&#39;);

                             if (anyway || type === &#39;load&#39; || (type === &#39;resize&#39; &amp;&amp; current.autoResize)) {
                                     F._setDimension();
                             }

                             if (!(type === &#39;scroll&#39; &amp;&amp; current.canShrink)) {
                                     F.reposition(e);
                             }

                             F.trigger(&#39;onUpdate&#39;);

                             didUpdate = null;

                     }, (anyway &amp;&amp; !isTouch ? 0 : 300));
             },

             // Shrink content to fit inside viewport or restore if resized
             toggle: function ( action ) {
                     if (F.isOpen) {
                             F.current.fitToView = $.type(action) === &quot;boolean&quot; ? action : !F.current.fitToView;

                             // Help browser to restore document dimensions
                             if (isTouch) {
                                     F.wrap.removeAttr(&#39;style&#39;).addClass(&#39;fancybox-tmp&#39;);

                                     F.trigger(&#39;onUpdate&#39;);
                             }

                             F.update();
                     }
             },

             hideLoading: function () {
                     D.unbind(&#39;.loading&#39;);

                     $(&#39;#fancybox-loading&#39;).remove();
             },

             showLoading: function () {
                     var el, viewport;

                     F.hideLoading();

                     el = $(&#39;&lt;div id=&quot;fancybox-loading&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&#39;).click(F.cancel).appendTo(&#39;body&#39;);

                     // If user will press the escape-button, the request will be canceled
                     D.bind(&#39;keydown.loading&#39;, function(e) {
                             if ((e.which || e.keyCode) === 27) {
                                     e.preventDefault();

                                     F.cancel();
                             }
                     });

                     if (!F.defaults.fixed) {
                             viewport = F.getViewport();

                             el.css({
                                     position : &#39;absolute&#39;,
                                     top  : (viewport.h * 0.5) + viewport.y,
                                     left : (viewport.w * 0.5) + viewport.x
                             });
                     }
             },

             getViewport: function () {
                     var locked = (F.current &amp;&amp; F.current.locked) || false,
                             rez    = {
                                     x: W.scrollLeft(),
                                     y: W.scrollTop()
                             };

                     if (locked) {
                             rez.w = locked[0].clientWidth;
                             rez.h = locked[0].clientHeight;

                     } else {
                             // See http://bugs.jquery.com/ticket/6724
                             rez.w = isTouch &amp;&amp; window.innerWidth  ? window.innerWidth  : W.width();
                             rez.h = isTouch &amp;&amp; window.innerHeight ? window.innerHeight : W.height();
                     }

                     return rez;
             },

             // Unbind the keyboard / clicking actions
             unbindEvents: function () {
                     if (F.wrap &amp;&amp; isQuery(F.wrap)) {
                             F.wrap.unbind(&#39;.fb&#39;);
                     }

                     D.unbind(&#39;.fb&#39;);
                     W.unbind(&#39;.fb&#39;);
             },

             bindEvents: function () {
                     var current = F.current,
                             keys;

                     if (!current) {
                             return;
                     }

                     // Changing document height on iOS devices triggers a &#39;resize&#39; event,
                     // that can change document height... repeating infinitely
                     W.bind(&#39;orientationchange.fb&#39; + (isTouch ? &#39;&#39; : &#39; resize.fb&#39;) + (current.autoCenter &amp;&amp; !current.locked ? &#39; scroll.fb&#39; : &#39;&#39;), F.update);

                     keys = current.keys;

                     if (keys) {
                             D.bind(&#39;keydown.fb&#39;, function (e) {
                                     var code   = e.which || e.keyCode,
                                             target = e.target || e.srcElement;

                                     // Skip esc key if loading, because showLoading will cancel preloading
                                     if (code === 27 &amp;&amp; F.coming) {
                                             return false;
                                     }

                                     // Ignore key combinations and key events within form elements
                                     if (!e.ctrlKey &amp;&amp; !e.altKey &amp;&amp; !e.shiftKey &amp;&amp; !e.metaKey &amp;&amp; !(target &amp;&amp; (target.type || $(target).is(&#39;[contenteditable]&#39;)))) {
                                             $.each(keys, function(i, val) {
                                                     if (current.group.length &gt; 1 &amp;&amp; val[ code ] !== undefined) {
                                                             F[ i ]( val[ code ] );

                                                             e.preventDefault();
                                                             return false;
                                                     }

                                                     if ($.inArray(code, val) &gt; -1) {
                                                             F[ i ] ();

                                                             e.preventDefault();
                                                             return false;
                                                     }
                                             });
                                     }
                             });
                     }

                     if ($.fn.mousewheel &amp;&amp; current.mouseWheel) {
                             F.wrap.bind(&#39;mousewheel.fb&#39;, function (e, delta, deltaX, deltaY) {
                                     var target = e.target || null,
                                             parent = $(target),
                                             canScroll = false;

                                     while (parent.length) {
                                             if (canScroll || parent.is(&#39;.fancybox-skin&#39;) || parent.is(&#39;.fancybox-wrap&#39;)) {
                                                     break;
                                             }

                                             canScroll = isScrollable( parent[0] );
                                             parent    = $(parent).parent();
                                     }

                                     if (delta !== 0 &amp;&amp; !canScroll) {
                                             if (F.group.length &gt; 1 &amp;&amp; !current.canShrink) {
                                                     if (deltaY &gt; 0 || deltaX &gt; 0) {
                                                             F.prev( deltaY &gt; 0 ? &#39;down&#39; : &#39;left&#39; );

                                                     } else if (deltaY &lt; 0 || deltaX &lt; 0) {
                                                             F.next( deltaY &lt; 0 ? &#39;up&#39; : &#39;right&#39; );
                                                     }

                                                     e.preventDefault();
                                             }
                                     }
                             });
                     }
             },

             trigger: function (event, o) {
                     var ret, obj = o || F.coming || F.current;

                     if (!obj) {
                             return;
                     }

                     if ($.isFunction( obj[event] )) {
                             ret = obj[event].apply(obj, Array.prototype.slice.call(arguments, 1));
                     }

                     if (ret === false) {
                             return false;
                     }

                     if (obj.helpers) {
                             $.each(obj.helpers, function (helper, opts) {
                                     if (opts &amp;&amp; F.helpers[helper] &amp;&amp; $.isFunction(F.helpers[helper][event])) {
                                             F.helpers[helper][event]($.extend(true, {}, F.helpers[helper].defaults, opts), obj);
                                     }
                             });
                     }

                     D.trigger(event);
             },

             isImage: function (str) {
                     return isString(str) &amp;&amp; str.match(/(^data:image\/.*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg)((\?|#).*)?$)/i);
             },

             isSWF: function (str) {
                     return isString(str) &amp;&amp; str.match(/\.(swf)((\?|#).*)?$/i);
             },

             _start: function (index) {
                     var coming = {},
                             obj,
                             href,
                             type,
                             margin,
                             padding;

                     index = getScalar( index );
                     obj   = F.group[ index ] || null;

                     if (!obj) {
                             return false;
                     }

                     coming = $.extend(true, {}, F.opts, obj);

                     // Convert margin and padding properties to array - top, right, bottom, left
                     margin  = coming.margin;
                     padding = coming.padding;

                     if ($.type(margin) === &#39;number&#39;) {
                             coming.margin = [margin, margin, margin, margin];
                     }

                     if ($.type(padding) === &#39;number&#39;) {
                             coming.padding = [padding, padding, padding, padding];
                     }

                     // &#39;modal&#39; propery is just a shortcut
                     if (coming.modal) {
                             $.extend(true, coming, {
                                     closeBtn   : false,
                                     closeClick : false,
                                     nextClick  : false,
                                     arrows     : false,
                                     mouseWheel : false,
                                     keys       : null,
                                     helpers: {
                                             overlay : {
                                                     closeClick : false
                                             }
                                     }
                             });
                     }

                     // &#39;autoSize&#39; property is a shortcut, too
                     if (coming.autoSize) {
                             coming.autoWidth = coming.autoHeight = true;
                     }

                     if (coming.width === &#39;auto&#39;) {
                             coming.autoWidth = true;
                     }

                     if (coming.height === &#39;auto&#39;) {
                             coming.autoHeight = true;
                     }

                     /*
   Add reference to the group, so it`s possible to access from callbacks, example:
   afterLoad : function() {
       this.title = &#39;Image &#39; + (this.index + 1) + &#39; of &#39; + this.group.length + (this.title ? &#39; - &#39; + this.title : &#39;&#39;);
   }
  /

                     coming.group  = F.group;
                     coming.index  = index;

                     // Give a chance for callback or helpers to update coming item (type, title, etc)
                     F.coming = coming;

                     if (false === F.trigger(&#39;beforeLoad&#39;)) {
                             F.coming = null;

                             return;
                     }

                     type = coming.type;
                     href = coming.href;

                     if (!type) {
                             F.coming = null;

                             //If we can not determine content type then drop silently or display next/prev item if looping through gallery
                             if (F.current &amp;&amp; F.router &amp;&amp; F.router !== &#39;jumpto&#39;) {
                                     F.current.index = index;

                                     return F[ F.router ]( F.direction );
                             }

                             return false;
                     }

                     F.isActive = true;

                     if (type === &#39;image&#39; || type === &#39;swf&#39;) {
                             coming.autoHeight = coming.autoWidth = false;
                             coming.scrolling  = &#39;visible&#39;;
                     }

                     if (type === &#39;image&#39;) {
                             coming.aspectRatio = true;
                     }

                     if (type === &#39;iframe&#39; &amp;&amp; isTouch) {
                             coming.scrolling = &#39;scroll&#39;;
                     }

                     // Build the neccessary markup
                     coming.wrap = $(coming.tpl.wrap).addClass(&#39;fancybox-&#39; + (isTouch ? &#39;mobile&#39; : &#39;desktop&#39;) + &#39; fancybox-type-&#39; + type + &#39; fancybox-tmp &#39; + coming.wrapCSS).appendTo( coming.parent || &#39;body&#39; );

                     $.extend(coming, {
                             skin  : $(&#39;.fancybox-skin&#39;,  coming.wrap),
                             outer : $(&#39;.fancybox-outer&#39;, coming.wrap),
                             inner : $(&#39;.fancybox-inner&#39;, coming.wrap)
                     });

                     $.each([&quot;Top&quot;, &quot;Right&quot;, &quot;Bottom&quot;, &quot;Left&quot;], function(i, v) {
                             coming.skin.css(&#39;padding&#39; + v, getValue(coming.padding[ i ]));
                     });

                     F.trigger(&#39;onReady&#39;);

                     // Check before try to load; &#39;inline&#39; and &#39;html&#39; types need content, others - href
                     if (type === &#39;inline&#39; || type === &#39;html&#39;) {
                             if (!coming.content || !coming.content.length) {
                                     return F._error( &#39;content&#39; );
                             }

                     } else if (!href) {
                             return F._error( &#39;href&#39; );
                     }

                     if (type === &#39;image&#39;) {
                             F._loadImage();

                     } else if (type === &#39;ajax&#39;) {
                             F._loadAjax();

                     } else if (type === &#39;iframe&#39;) {
                             F._loadIframe();

                     } else {
                             F._afterLoad();
                     }
             },

             _error: function ( type ) {
                     $.extend(F.coming, {
                             type       : &#39;html&#39;,
                             autoWidth  : true,
                             autoHeight : true,
                             minWidth   : 0,
                             minHeight  : 0,
                             scrolling  : &#39;no&#39;,
                             hasError   : type,
                             content    : F.coming.tpl.error
                     });

                     F._afterLoad();
             },

             _loadImage: function () {
                     // Reset preload image so it is later possible to check &quot;complete&quot; property
                     var img = F.imgPreload = new Image();

                     img.onload = function () {
                             this.onload = this.onerror = null;

                             F.coming.width  = this.width / F.opts.pixelRatio;
                             F.coming.height = this.height / F.opts.pixelRatio;

                             F._afterLoad();
                     };

                     img.onerror = function () {
                             this.onload = this.onerror = null;

                             F._error( &#39;image&#39; );
                     };

                     img.src = F.coming.href;

                     if (img.complete !== true) {
                             F.showLoading();
                     }
             },

             _loadAjax: function () {
                     var coming = F.coming;

                     F.showLoading();

                     F.ajaxLoad = $.ajax($.extend({}, coming.ajax, {
                             url: coming.href,
                             error: function (jqXHR, textStatus) {
                                     if (F.coming &amp;&amp; textStatus !== &#39;abort&#39;) {
                                             F._error( &#39;ajax&#39;, jqXHR );

                                     } else {
                                             F.hideLoading();
                                     }
                             },
                             success: function (data, textStatus) {
                                     if (textStatus === &#39;success&#39;) {
                                             coming.content = data;

                                             F._afterLoad();
                                     }
                             }
                     }));
             },

             _loadIframe: function() {
                     var coming = F.coming,
                             iframe = $(coming.tpl.iframe.replace(/\{rnd\}/g, new Date().getTime()))
                                     .attr(&#39;scrolling&#39;, isTouch ? &#39;auto&#39; : coming.iframe.scrolling)
                                     .attr(&#39;src&#39;, coming.href);

                     // This helps IE
                     $(coming.wrap).bind(&#39;onReset&#39;, function () {
                             try {
                                     $(this).find(&#39;iframe&#39;).hide().attr(&#39;src&#39;, &#39;//about:blank&#39;).end().empty();
                             } catch (e) {}
                     });

                     if (coming.iframe.preload) {
                             F.showLoading();

                             iframe.one(&#39;load&#39;, function() {
                                     $(this).data(&#39;ready&#39;, 1);

                                     // iOS will lose scrolling if we resize
                                     if (!isTouch) {
                                             $(this).bind(&#39;load.fb&#39;, F.update);
                                     }

                                     // Without this trick:
                                     //   - iframe won&#39;t scroll on iOS devices
                                     //   - IE7 sometimes displays empty iframe
                                     $(this).parents(&#39;.fancybox-wrap&#39;).width(&#39;100%&#39;).removeClass(&#39;fancybox-tmp&#39;).show();

                                     F._afterLoad();
                             });
                     }

                     coming.content = iframe.appendTo( coming.inner );

                     if (!coming.iframe.preload) {
                             F._afterLoad();
                     }
             },

             _preloadImages: function() {
                     var group   = F.group,
                             current = F.current,
                             len     = group.length,
                             cnt     = current.preload ? Math.min(current.preload, len - 1) : 0,
                             item,
                             i;

                     for (i = 1; i &lt;= cnt; i += 1) {
                             item = group[ (current.index + i ) % len ];

                             if (item.type === &#39;image&#39; &amp;&amp; item.href) {
                                     new Image().src = item.href;
                             }
                     }
             },

             _afterLoad: function () {
                     var coming   = F.coming,
                             previous = F.current,
                             placeholder = &#39;fancybox-placeholder&#39;,
                             current,
                             content,
                             type,
                             scrolling,
                             href,
                             embed;

                     F.hideLoading();

                     if (!coming || F.isActive === false) {
                             return;
                     }

                     if (false === F.trigger(&#39;afterLoad&#39;, coming, previous)) {
                             coming.wrap.stop(true).trigger(&#39;onReset&#39;).remove();

                             F.coming = null;

                             return;
                     }

                     if (previous) {
                             F.trigger(&#39;beforeChange&#39;, previous);

                             previous.wrap.stop(true).removeClass(&#39;fancybox-opened&#39;)
                                     .find(&#39;.fancybox-item, .fancybox-nav&#39;)
                                     .remove();
                     }

                     F.unbindEvents();

                     current   = coming;
                     content   = coming.content;
                     type      = coming.type;
                     scrolling = coming.scrolling;

                     $.extend(F, {
                             wrap  : current.wrap,
                             skin  : current.skin,
                             outer : current.outer,
                             inner : current.inner,
                             current  : current,
                             previous : previous
                     });

                     href = current.href;

                     switch (type) {
                             case &#39;inline&#39;:
                             case &#39;ajax&#39;:
                             case &#39;html&#39;:
                                     if (current.selector) {
                                             content = $(&#39;&lt;div&gt;&#39;).html(content).find(current.selector);

                                     } else if (isQuery(content)) {
                                             if (!content.data(placeholder)) {
                                                     content.data(placeholder, $(&#39;&lt;div class=&quot;&#39; + placeholder + &#39;&quot;&gt;&lt;/div&gt;&#39;).insertAfter( content ).hide() );
                                             }

                                             content = content.show().detach();

                                             current.wrap.bind(&#39;onReset&#39;, function () {
                                                     if ($(this).find(content).length) {
                                                             content.hide().replaceAll( content.data(placeholder) ).data(placeholder, false);
                                                     }
                                             });
                                     }
                             break;

                             case &#39;image&#39;:
                                     content = current.tpl.image.replace(&#39;{href}&#39;, href);
                             break;

                             case &#39;swf&#39;:
                                     content = &#39;&lt;object id=&quot;fancybox-swf&quot; classid=&quot;clsid:D27CDB6E-AE6D-11cf-96B8-444553540000&quot; width=&quot;100%&quot; height=&quot;100%&quot;&gt;&lt;param name=&quot;movie&quot; value=&quot;&#39; + href + &#39;&quot;&gt;&lt;/param&gt;&#39;;
                                     embed   = &#39;&#39;;

                                     $.each(current.swf, function(name, val) {
                                             content += &#39;&lt;param name=&quot;&#39; + name + &#39;&quot; value=&quot;&#39; + val + &#39;&quot;&gt;&lt;/param&gt;&#39;;
                                             embed   += &#39; &#39; + name + &#39;=&quot;&#39; + val + &#39;&quot;&#39;;
                                     });

                                     content += &#39;&lt;embed src=&quot;&#39; + href + &#39;&quot; type=&quot;application/x-shockwave-flash&quot; width=&quot;100%&quot; height=&quot;100%&quot;&#39; + embed + &#39;&gt;&lt;/embed&gt;&lt;/object&gt;&#39;;
                             break;
                     }

                     if (!(isQuery(content) &amp;&amp; content.parent().is(current.inner))) {
                             current.inner.append( content );
                     }

                     // Give a chance for helpers or callbacks to update elements
                     F.trigger(&#39;beforeShow&#39;);

                     // Set scrolling before calculating dimensions
                     current.inner.css(&#39;overflow&#39;, scrolling === &#39;yes&#39; ? &#39;scroll&#39; : (scrolling === &#39;no&#39; ? &#39;hidden&#39; : scrolling));

                     // Set initial dimensions and start position
                     F._setDimension();

                     F.reposition();

                     F.isOpen = false;
                     F.coming = null;

                     F.bindEvents();

                     if (!F.isOpened) {
                             $(&#39;.fancybox-wrap&#39;).not( current.wrap ).stop(true).trigger(&#39;onReset&#39;).remove();

                     } else if (previous.prevMethod) {
                             F.transitions[ previous.prevMethod ]();
                     }

                     F.transitions[ F.isOpened ? current.nextMethod : current.openMethod ]();

                     F._preloadImages();
             },

             _setDimension: function () {
                     var viewport   = F.getViewport(),
                             steps      = 0,
                             canShrink  = false,
                             canExpand  = false,
                             wrap       = F.wrap,
                             skin       = F.skin,
                             inner      = F.inner,
                             current    = F.current,
                             width      = current.width,
                             height     = current.height,
                             minWidth   = current.minWidth,
                             minHeight  = current.minHeight,
                             maxWidth   = current.maxWidth,
                             maxHeight  = current.maxHeight,
                             scrolling  = current.scrolling,
                             scrollOut  = current.scrollOutside ? current.scrollbarWidth : 0,
                             margin     = current.margin,
                             wMargin    = getScalar(margin[1] + margin[3]),
                             hMargin    = getScalar(margin[0] + margin[2]),
                             wPadding,
                             hPadding,
                             wSpace,
                             hSpace,
                             origWidth,
                             origHeight,
                             origMaxWidth,
                             origMaxHeight,
                             ratio,
                             width_,
                             height_,
                             maxWidth_,
                             maxHeight_,
                             iframe,
                             body;

                     // Reset dimensions so we could re-check actual size
                     wrap.add(skin).add(inner).width(&#39;auto&#39;).height(&#39;auto&#39;).removeClass(&#39;fancybox-tmp&#39;);

                     wPadding = getScalar(skin.outerWidth(true)  - skin.width());
                     hPadding = getScalar(skin.outerHeight(true) - skin.height());

                     // Any space between content and viewport (margin, padding, border, title)
                     wSpace = wMargin + wPadding;
                     hSpace = hMargin + hPadding;

                     origWidth  = isPercentage(width)  ? (viewport.w - wSpace) * getScalar(width)  / 100 : width;
                     origHeight = isPercentage(height) ? (viewport.h - hSpace) * getScalar(height) / 100 : height;

                     if (current.type === &#39;iframe&#39;) {
                             iframe = current.content;

                             if (current.autoHeight &amp;&amp; iframe.data(&#39;ready&#39;) === 1) {
                                     try {
                                             if (iframe[0].contentWindow.document.location) {
                                                     inner.width( origWidth ).height(9999);

                                                     body = iframe.contents().find(&#39;body&#39;);

                                                     if (scrollOut) {
                                                             body.css(&#39;overflow-x&#39;, &#39;hidden&#39;);
                                                     }

                                                     origHeight = body.outerHeight(true);
                                             }

                                     } catch (e) {}
                             }

                     } else if (current.autoWidth || current.autoHeight) {
                             inner.addClass( &#39;fancybox-tmp&#39; );

                             // Set width or height in case we need to calculate only one dimension
                             if (!current.autoWidth) {
                                     inner.width( origWidth );
                             }

                             if (!current.autoHeight) {
                                     inner.height( origHeight );
                             }

                             if (current.autoWidth) {
                                     origWidth = inner.width();
                             }

                             if (current.autoHeight) {
                                     origHeight = inner.height();
                             }

                             inner.removeClass( &#39;fancybox-tmp&#39; );
                     }

                     width  = getScalar( origWidth );
                     height = getScalar( origHeight );

                     ratio  = origWidth / origHeight;

                     // Calculations for the content
                     minWidth  = getScalar(isPercentage(minWidth) ? getScalar(minWidth, &#39;w&#39;) - wSpace : minWidth);
                     maxWidth  = getScalar(isPercentage(maxWidth) ? getScalar(maxWidth, &#39;w&#39;) - wSpace : maxWidth);

                     minHeight = getScalar(isPercentage(minHeight) ? getScalar(minHeight, &#39;h&#39;) - hSpace : minHeight);
                     maxHeight = getScalar(isPercentage(maxHeight) ? getScalar(maxHeight, &#39;h&#39;) - hSpace : maxHeight);

                     // These will be used to determine if wrap can fit in the viewport
                     origMaxWidth  = maxWidth;
                     origMaxHeight = maxHeight;

                     if (current.fitToView) {
                             maxWidth  = Math.min(viewport.w - wSpace, maxWidth);
                             maxHeight = Math.min(viewport.h - hSpace, maxHeight);
                     }

                     maxWidth_  = viewport.w - wMargin;
                     maxHeight_ = viewport.h - hMargin;

                     if (current.aspectRatio) {
                             if (width &gt; maxWidth) {
                                     width  = maxWidth;
                                     height = getScalar(width / ratio);
                             }

                             if (height &gt; maxHeight) {
                                     height = maxHeight;
                                     width  = getScalar(height * ratio);
                             }

                             if (width &lt; minWidth) {
                                     width  = minWidth;
                                     height = getScalar(width / ratio);
                             }

                             if (height &lt; minHeight) {
                                     height = minHeight;
                                     width  = getScalar(height * ratio);
                             }

                     } else {
                             width = Math.max(minWidth, Math.min(width, maxWidth));

                             if (current.autoHeight &amp;&amp; current.type !== &#39;iframe&#39;) {
                                     inner.width( width );

                                     height = inner.height();
                             }

                             height = Math.max(minHeight, Math.min(height, maxHeight));
                     }

                     // Try to fit inside viewport (including the title)
                     if (current.fitToView) {
                             inner.width( width ).height( height );

                             wrap.width( width + wPadding );

                             // Real wrap dimensions
                             width_  = wrap.width();
                             height_ = wrap.height();

                             if (current.aspectRatio) {
                                     while ((width_ &gt; maxWidth_ || height_ &gt; maxHeight_) &amp;&amp; width &gt; minWidth &amp;&amp; height &gt; minHeight) {
                                             if (steps++ &gt; 19) {
                                                     break;
                                             }

                                             height = Math.max(minHeight, Math.min(maxHeight, height - 10));
                                             width  = getScalar(height * ratio);

                                             if (width &lt; minWidth) {
                                                     width  = minWidth;
                                                     height = getScalar(width / ratio);
                                             }

                                             if (width &gt; maxWidth) {
                                                     width  = maxWidth;
                                                     height = getScalar(width / ratio);
                                             }

                                             inner.width( width ).height( height );

                                             wrap.width( width + wPadding );

                                             width_  = wrap.width();
                                             height_ = wrap.height();
                                     }

                             } else {
                                     width  = Math.max(minWidth,  Math.min(width,  width  - (width_  - maxWidth_)));
                                     height = Math.max(minHeight, Math.min(height, height - (height_ - maxHeight_)));
                             }
                     }

                     if (scrollOut &amp;&amp; scrolling === &#39;auto&#39; &amp;&amp; height &lt; origHeight &amp;&amp; (width + wPadding + scrollOut) &lt; maxWidth_) {
                             width += scrollOut;
                     }

                     inner.width( width ).height( height );

                     wrap.width( width + wPadding );

                     width_  = wrap.width();
                     height_ = wrap.height();

                     canShrink = (width_ &gt; maxWidth_ || height_ &gt; maxHeight_) &amp;&amp; width &gt; minWidth &amp;&amp; height &gt; minHeight;
                     canExpand = current.aspectRatio ? (width &lt; origMaxWidth &amp;&amp; height &lt; origMaxHeight &amp;&amp; width &lt; origWidth &amp;&amp; height &lt; origHeight) : ((width &lt; origMaxWidth || height &lt; origMaxHeight) &amp;&amp; (width &lt; origWidth || height &lt; origHeight));

                     $.extend(current, {
                             dim : {
                                     width   : getValue( width_ ),
                                     height  : getValue( height_ )
                             },
                             origWidth  : origWidth,
                             origHeight : origHeight,
                             canShrink  : canShrink,
                             canExpand  : canExpand,
                             wPadding   : wPadding,
                             hPadding   : hPadding,
                             wrapSpace  : height_ - skin.outerHeight(true),
                             skinSpace  : skin.height() - height
                     });

                     if (!iframe &amp;&amp; current.autoHeight &amp;&amp; height &gt; minHeight &amp;&amp; height &lt; maxHeight &amp;&amp; !canExpand) {
                             inner.height(&#39;auto&#39;);
                     }
             },

             _getPosition: function (onlyAbsolute) {
                     var current  = F.current,
                             viewport = F.getViewport(),
                             margin   = current.margin,
                             width    = F.wrap.width()  + margin[1] + margin[3],
                             height   = F.wrap.height() + margin[0] + margin[2],
                             rez      = {
                                     position: &#39;absolute&#39;,
                                     top  : margin[0],
                                     left : margin[3]
                             };

                     if (current.autoCenter &amp;&amp; current.fixed &amp;&amp; !onlyAbsolute &amp;&amp; height &lt;= viewport.h &amp;&amp; width &lt;= viewport.w) {
                             rez.position = &#39;fixed&#39;;

                     } else if (!current.locked) {
                             rez.top  += viewport.y;
                             rez.left += viewport.x;
                     }

                     rez.top  = getValue(Math.max(rez.top,  rez.top  + ((viewport.h - height) * current.topRatio)));
                     rez.left = getValue(Math.max(rez.left, rez.left + ((viewport.w - width)  * current.leftRatio)));

                     return rez;
             },

             _afterZoomIn: function () {
                     var current = F.current;

                     if (!current) {
                             return;
                     }

                     F.isOpen = F.isOpened = true;

                     F.wrap.css(&#39;overflow&#39;, &#39;visible&#39;).addClass(&#39;fancybox-opened&#39;);

                     F.update();

                     // Assign a click event
                     if ( current.closeClick || (current.nextClick &amp;&amp; F.group.length &gt; 1) ) {
                             F.inner.css(&#39;cursor&#39;, &#39;pointer&#39;).bind(&#39;click.fb&#39;, function(e) {
                                     if (!$(e.target).is(&#39;a&#39;) &amp;&amp; !$(e.target).parent().is(&#39;a&#39;)) {
                                             e.preventDefault();

                                             F[ current.closeClick ? &#39;close&#39; : &#39;next&#39; ]();
                                     }
                             });
                     }

                     // Create a close button
                     if (current.closeBtn) {
                             $(current.tpl.closeBtn).appendTo(F.skin).bind(&#39;click.fb&#39;, function(e) {
                                     e.preventDefault();

                                     F.close();
                             });
                     }

                     // Create navigation arrows
                     if (current.arrows &amp;&amp; F.group.length &gt; 1) {
                             if (current.loop || current.index &gt; 0) {
                                     $(current.tpl.prev).appendTo(F.outer).bind(&#39;click.fb&#39;, F.prev);
                             }

                             if (current.loop || current.index &lt; F.group.length - 1) {
                                     $(current.tpl.next).appendTo(F.outer).bind(&#39;click.fb&#39;, F.next);
                             }
                     }

                     F.trigger(&#39;afterShow&#39;);

                     // Stop the slideshow if this is the last item
                     if (!current.loop &amp;&amp; current.index === current.group.length - 1) {
                             F.play( false );

                     } else if (F.opts.autoPlay &amp;&amp; !F.player.isActive) {
                             F.opts.autoPlay = false;

                             F.play();
                     }
             },

             _afterZoomOut: function ( obj ) {
                     obj = obj || F.current;

                     $(&#39;.fancybox-wrap&#39;).trigger(&#39;onReset&#39;).remove();

                     $.extend(F, {
                             group  : {},
                             opts   : {},
                             router : false,
                             current   : null,
                             isActive  : false,
                             isOpened  : false,
                             isOpen    : false,
                             isClosing : false,
                             wrap   : null,
                             skin   : null,
                             outer  : null,
                             inner  : null
                     });

                     F.trigger(&#39;afterClose&#39;, obj);
             }
     });

     /*
     Default transitions
/

     F.transitions = {
             getOrigPosition: function () {
                     var current  = F.current,
                             element  = current.element,
                             orig     = current.orig,
                             pos      = {},
                             width    = 50,
                             height   = 50,
                             hPadding = current.hPadding,
                             wPadding = current.wPadding,
                             viewport = F.getViewport();

                     if (!orig &amp;&amp; current.isDom &amp;&amp; element.is(&#39;:visible&#39;)) {
                             orig = element.find(&#39;img:first&#39;);

                             if (!orig.length) {
                                     orig = element;
                             }
                     }

                     if (isQuery(orig)) {
                             pos = orig.offset();

                             if (orig.is(&#39;img&#39;)) {
                                     width  = orig.outerWidth();
                                     height = orig.outerHeight();
                             }

                     } else {
                             pos.top  = viewport.y + (viewport.h - height) * current.topRatio;
                             pos.left = viewport.x + (viewport.w - width)  * current.leftRatio;
                     }

                     if (F.wrap.css(&#39;position&#39;) === &#39;fixed&#39; || current.locked) {
                             pos.top  -= viewport.y;
                             pos.left -= viewport.x;
                     }

                     pos = {
                             top     : getValue(pos.top  - hPadding * current.topRatio),
                             left    : getValue(pos.left - wPadding * current.leftRatio),
                             width   : getValue(width  + wPadding),
                             height  : getValue(height + hPadding)
                     };

                     return pos;
             },

             step: function (now, fx) {
                     var ratio,
                             padding,
                             value,
                             prop       = fx.prop,
                             current    = F.current,
                             wrapSpace  = current.wrapSpace,
                             skinSpace  = current.skinSpace;

                     if (prop === &#39;width&#39; || prop === &#39;height&#39;) {
                             ratio = fx.end === fx.start ? 1 : (now - fx.start) / (fx.end - fx.start);

                             if (F.isClosing) {
                                     ratio = 1 - ratio;
                             }

                             padding = prop === &#39;width&#39; ? current.wPadding : current.hPadding;
                             value   = now - padding;

                             F.skin[ prop ](  getScalar( prop === &#39;width&#39; ?  value : value - (wrapSpace * ratio) ) );
                             F.inner[ prop ]( getScalar( prop === &#39;width&#39; ?  value : value - (wrapSpace * ratio) - (skinSpace * ratio) ) );
                     }
             },

             zoomIn: function () {
                     var current  = F.current,
                             startPos = current.pos,
                             effect   = current.openEffect,
                             elastic  = effect === &#39;elastic&#39;,
                             endPos   = $.extend({opacity : 1}, startPos);

                     // Remove &quot;position&quot; property that breaks older IE
                     delete endPos.position;

                     if (elastic) {
                             startPos = this.getOrigPosition();

                             if (current.openOpacity) {
                                     startPos.opacity = 0.1;
                             }

                     } else if (effect === &#39;fade&#39;) {
                             startPos.opacity = 0.1;
                     }

                     F.wrap.css(startPos).animate(endPos, {
                             duration : effect === &#39;none&#39; ? 0 : current.openSpeed,
                             easing   : current.openEasing,
                             step     : elastic ? this.step : null,
                             complete : F._afterZoomIn
                     });
             },

             zoomOut: function () {
                     var current  = F.current,
                             effect   = current.closeEffect,
                             elastic  = effect === &#39;elastic&#39;,
                             endPos   = {opacity : 0.1};

                     if (elastic) {
                             endPos = this.getOrigPosition();

                             if (current.closeOpacity) {
                                     endPos.opacity = 0.1;
                             }
                     }

                     F.wrap.animate(endPos, {
                             duration : effect === &#39;none&#39; ? 0 : current.closeSpeed,
                             easing   : current.closeEasing,
                             step     : elastic ? this.step : null,
                             complete : F._afterZoomOut
                     });
             },

             changeIn: function () {
                     var current   = F.current,
                             effect    = current.nextEffect,
                             startPos  = current.pos,
                             endPos    = { opacity : 1 },
                             direction = F.direction,
                             distance  = 200,
                             field;

                     startPos.opacity = 0.1;

                     if (effect === &#39;elastic&#39;) {
                             field = direction === &#39;down&#39; || direction === &#39;up&#39; ? &#39;top&#39; : &#39;left&#39;;

                             if (direction === &#39;down&#39; || direction === &#39;right&#39;) {
                                     startPos[ field ] = getValue(getScalar(startPos[ field ]) - distance);
                                     endPos[ field ]   = &#39;+=&#39; + distance + &#39;px&#39;;

                             } else {
                                     startPos[ field ] = getValue(getScalar(startPos[ field ]) + distance);
                                     endPos[ field ]   = &#39;-=&#39; + distance + &#39;px&#39;;
                             }
                     }

                     // Workaround for http://bugs.jquery.com/ticket/12273
                     if (effect === &#39;none&#39;) {
                             F._afterZoomIn();

                     } else {
                             F.wrap.css(startPos).animate(endPos, {
                                     duration : current.nextSpeed,
                                     easing   : current.nextEasing,
                                     complete : F._afterZoomIn
                             });
                     }
             },

             changeOut: function () {
                     var previous  = F.previous,
                             effect    = previous.prevEffect,
                             endPos    = { opacity : 0.1 },
                             direction = F.direction,
                             distance  = 200;

                     if (effect === &#39;elastic&#39;) {
                             endPos[ direction === &#39;down&#39; || direction === &#39;up&#39; ? &#39;top&#39; : &#39;left&#39; ] = ( direction === &#39;up&#39; || direction === &#39;left&#39; ? &#39;-&#39; : &#39;+&#39; ) + &#39;=&#39; + distance + &#39;px&#39;;
                     }

                     previous.wrap.animate(endPos, {
                             duration : effect === &#39;none&#39; ? 0 : previous.prevSpeed,
                             easing   : previous.prevEasing,
                             complete : function () {
                                     $(this).trigger(&#39;onReset&#39;).remove();
                             }
                     });
             }
     };

     /*
     Overlay helper
/

     F.helpers.overlay = {
             defaults : {
                     closeClick : true,      // if true, fancyBox will be closed when user clicks on the overlay
                     speedOut   : 200,       // duration of fadeOut animation
                     showEarly  : true,      // indicates if should be opened immediately or wait until the content is ready
                     css        : {},        // custom CSS properties
                     locked     : !isTouch,  // if true, the content will be locked into overlay
                     fixed      : true       // if false, the overlay CSS position property will not be set to &quot;fixed&quot;
             },

             overlay : null,      // current handle
             fixed   : false,     // indicates if the overlay has position &quot;fixed&quot;
             el      : $(&#39;html&#39;), // element that contains &quot;the lock&quot;

             // Public methods
             create : function(opts) {
                     opts = $.extend({}, this.defaults, opts);

                     if (this.overlay) {
                             this.close();
                     }

                     this.overlay = $(&#39;&lt;div class=&quot;fancybox-overlay&quot;&gt;&lt;/div&gt;&#39;).appendTo( F.coming ? F.coming.parent : opts.parent );
                     this.fixed   = false;

                     if (opts.fixed &amp;&amp; F.defaults.fixed) {
                             this.overlay.addClass(&#39;fancybox-overlay-fixed&#39;);

                             this.fixed = true;
                     }
             },

             open : function(opts) {
                     var that = this;

                     opts = $.extend({}, this.defaults, opts);

                     if (this.overlay) {
                             this.overlay.unbind(&#39;.overlay&#39;).width(&#39;auto&#39;).height(&#39;auto&#39;);

                     } else {
                             this.create(opts);
                     }

                     if (!this.fixed) {
                             W.bind(&#39;resize.overlay&#39;, $.proxy( this.update, this) );

                             this.update();
                     }

                     if (opts.closeClick) {
                             this.overlay.bind(&#39;click.overlay&#39;, function(e) {
                                     if ($(e.target).hasClass(&#39;fancybox-overlay&#39;)) {
                                             if (F.isActive) {
                                                     F.close();
                                             } else {
                                                     that.close();
                                             }

                                             return false;
                                     }
                             });
                     }

                     this.overlay.css( opts.css ).show();
             },

             close : function() {
                     var scrollV, scrollH;

                     W.unbind(&#39;resize.overlay&#39;);

                     if (this.el.hasClass(&#39;fancybox-lock&#39;)) {
                             $(&#39;.fancybox-margin&#39;).removeClass(&#39;fancybox-margin&#39;);

                             scrollV = W.scrollTop();
                             scrollH = W.scrollLeft();

                             this.el.removeClass(&#39;fancybox-lock&#39;);

                             W.scrollTop( scrollV ).scrollLeft( scrollH );
                     }

                     $(&#39;.fancybox-overlay&#39;).remove().hide();

                     $.extend(this, {
                             overlay : null,
                             fixed   : false
                     });
             },

             // Private, callbacks

             update : function () {
                     var width = &#39;100%&#39;, offsetWidth;

                     // Reset width/height so it will not mess
                     this.overlay.width(width).height(&#39;100%&#39;);

                     // jQuery does not return reliable result for IE
                     if (IE) {
                             offsetWidth = Math.max(document.documentElement.offsetWidth, document.body.offsetWidth);

                             if (D.width() &gt; offsetWidth) {
                                     width = D.width();
                             }

                     } else if (D.width() &gt; W.width()) {
                             width = D.width();
                     }

                     this.overlay.width(width).height(D.height());
             },

             // This is where we can manipulate DOM, because later it would cause iframes to reload
             onReady : function (opts, obj) {
                     var overlay = this.overlay;

                     $(&#39;.fancybox-overlay&#39;).stop(true, true);

                     if (!overlay) {
                             this.create(opts);
                     }

                     if (opts.locked &amp;&amp; this.fixed &amp;&amp; obj.fixed) {
                             if (!overlay) {
                                     this.margin = D.height() &gt; W.height() ? $(&#39;html&#39;).css(&#39;margin-right&#39;).replace(&quot;px&quot;, &quot;&quot;) : false;
                             }

                             obj.locked = this.overlay.append( obj.wrap );
                             obj.fixed  = false;
                     }

                     if (opts.showEarly === true) {
                             this.beforeShow.apply(this, arguments);
                     }
             },

             beforeShow : function(opts, obj) {
                     var scrollV, scrollH;

                     if (obj.locked) {
                             if (this.margin !== false) {
                                     $(&#39;*&#39;).filter(function(){
                                             return ($(this).css(&#39;position&#39;) === &#39;fixed&#39; &amp;&amp; !$(this).hasClass(&quot;fancybox-overlay&quot;) &amp;&amp; !$(this).hasClass(&quot;fancybox-wrap&quot;) );
                                     }).addClass(&#39;fancybox-margin&#39;);

                                     this.el.addClass(&#39;fancybox-margin&#39;);
                             }

                             scrollV = W.scrollTop();
                             scrollH = W.scrollLeft();

                             this.el.addClass(&#39;fancybox-lock&#39;);

                             W.scrollTop( scrollV ).scrollLeft( scrollH );
                     }

                     this.open(opts);
             },

             onUpdate : function() {
                     if (!this.fixed) {
                             this.update();
                     }
             },

             afterClose: function (opts) {
                     // Remove overlay if exists and fancyBox is not opening
                     // (e.g., it is not being open using afterClose callback)
                     //if (this.overlay &amp;&amp; !F.isActive) {
                     if (this.overlay &amp;&amp; !F.coming) {
                             this.overlay.fadeOut(opts.speedOut, $.proxy( this.close, this ));
                     }
             }
     };

     /*
     Title helper
/

     F.helpers.title = {
             defaults : {
                     type     : &#39;float&#39;, // &#39;float&#39;, &#39;inside&#39;, &#39;outside&#39; or &#39;over&#39;,
                     position : &#39;bottom&#39; // &#39;top&#39; or &#39;bottom&#39;
             },

             beforeShow: function (opts) {
                     var current = F.current,
                             text    = current.title,
                             type    = opts.type,
                             title,
                             target;

                     if ($.isFunction(text)) {
                             text = text.call(current.element, current);
                     }

                     if (!isString(text) || $.trim(text) === &#39;&#39;) {
                             return;
                     }

                     title = $(&#39;&lt;div class=&quot;fancybox-title fancybox-title-&#39; + type + &#39;-wrap&quot;&gt;&#39; + text + &#39;&lt;/div&gt;&#39;);

                     switch (type) {
                             case &#39;inside&#39;:
                                     target = F.skin;
                             break;

                             case &#39;outside&#39;:
                                     target = F.wrap;
                             break;

                             case &#39;over&#39;:
                                     target = F.inner;
                             break;

                             default: // &#39;float&#39;
                                     target = F.skin;

                                     title.appendTo(&#39;body&#39;);

                                     if (IE) {
                                             title.width( title.width() );
                                     }

                                     title.wrapInner(&#39;&lt;span class=&quot;child&quot;&gt;&lt;/span&gt;&#39;);

                                     //Increase bottom margin so this title will also fit into viewport
                                     F.current.margin[2] += Math.abs( getScalar(title.css(&#39;margin-bottom&#39;)) );
                             break;
                     }

                     title[ (opts.position === &#39;top&#39; ? &#39;prependTo&#39;  : &#39;appendTo&#39;) ](target);
             }
     };

     // jQuery plugin initialization
     $.fn.fancybox = function (options) {
             var index,
                     that     = $(this),
                     selector = this.selector || &#39;&#39;,
                     run      = function(e) {
                             var what = $(this).blur(), idx = index, relType, relVal;

                             if (!(e.ctrlKey || e.altKey || e.shiftKey || e.metaKey) &amp;&amp; !what.is(&#39;.fancybox-wrap&#39;)) {
                                     relType = options.groupAttr || &#39;data-fancybox-group&#39;;
                                     relVal  = what.attr(relType);

                                     if (!relVal) {
                                             relType = &#39;rel&#39;;
                                             relVal  = what.get(0)[ relType ];
                                     }

                                     if (relVal &amp;&amp; relVal !== &#39;&#39; &amp;&amp; relVal !== &#39;nofollow&#39;) {
                                             what = selector.length ? $(selector) : that;
                                             what = what.filter(&#39;[&#39; + relType + &#39;=&quot;&#39; + relVal + &#39;&quot;]&#39;);
                                             idx  = what.index(this);
                                     }

                                     options.index = idx;

                                     // Stop an event from bubbling if everything is fine
                                     if (F.open(what, options) !== false) {
                                             e.preventDefault();
                                     }
                             }
                     };

             options = options || {};
             index   = options.index || 0;

             if (!selector || options.live === false) {
                     that.unbind(&#39;click.fb-start&#39;).bind(&#39;click.fb-start&#39;, run);

             } else {
                     D.undelegate(selector, &#39;click.fb-start&#39;).delegate(selector + &quot;:not(&#39;.fancybox-item, .fancybox-nav&#39;)&quot;, &#39;click.fb-start&#39;, run);
             }

             this.filter(&#39;[data-fancybox-start=1]&#39;).trigger(&#39;click&#39;);

             return this;
     };

     // Tests that need a body at doc ready
     D.ready(function() {
             var w1, w2;

             if ( $.scrollbarWidth === undefined ) {
                     // http://benalman.com/projects/jquery-misc-plugins/#scrollbarwidth
                     $.scrollbarWidth = function() {
                             var parent = $(&#39;&lt;div style=&quot;width:50px;height:50px;overflow:auto&quot;&gt;&lt;div/&gt;&lt;/div&gt;&#39;).appendTo(&#39;body&#39;),
                                     child  = parent.children(),
                                     width  = child.innerWidth() - child.height( 99 ).innerWidth();

                             parent.remove();

                             return width;
                     };
             }

             if ( $.support.fixedPosition === undefined ) {
                     $.support.fixedPosition = (function() {
                             var elem  = $(&#39;&lt;div style=&quot;position:fixed;top:20px;&quot;&gt;&lt;/div&gt;&#39;).appendTo(&#39;body&#39;),
                                     fixed = ( elem[0].offsetTop === 20 || elem[0].offsetTop === 15 );

                             elem.remove();

                             return fixed;
                     }());
             }

             $.extend(F.defaults, {
                     scrollbarWidth : $.scrollbarWidth(),
                     fixed  : $.support.fixedPosition,
                     parent : $(&#39;body&#39;)
             });

             //Get real width of page scroll-bar
             w1 = $(window).width();

             H.addClass(&#39;fancybox-lock-test&#39;);

             w2 = $(window).width();

             H.removeClass(&#39;fancybox-lock-test&#39;);

             $(&quot;&lt;style type=&#39;text/css&#39;&gt;.fancybox-margin{margin-right:&quot; + (w2 - w1) + &quot;px;}&lt;/style&gt;&quot;).appendTo(&quot;head&quot;);
     });</code></pre>

<p>}(window, document, jQuery));</p>

    </div>
  


  


  
  


  


  

  



  

    

    

    


    


    <!-- Methods -->
              </div>

    </div>
  </body>
</html>
